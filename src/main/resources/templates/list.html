<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="57x57" href="/img/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/img/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/img/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/img/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/img/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/img/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/img/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../css/header.css" rel="stylesheet">
    <link href="../css/drop.css" rel="stylesheet">
    <title>홈페이지 회원 목록</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* 가로 스크롤 방지 */
        }

        h2 {
            text-align: center;
            margin-top: 20px;
            color: #333;
        }

        .home-button {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 12px 18px;
            margin: 20px;
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
        }

        .home-button:hover {
            background-color: #45a049;
        }

        table {
            width: 100%;
            margin: 20px auto;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            table-layout: fixed; /* 테이블 셀 크기 고정 */
        }

        th, td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #ddd;
            overflow: hidden; /* 넘치는 내용 숨김 */
            text-overflow: ellipsis; /* 내용이 길면 생략 기호로 표시 */
            white-space: nowrap; /* 텍스트 줄 바꿈 방지 */
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        td {
            background-color: #f9f9f9;
        }

        tr:hover td {
            background-color: #f1f1f1;
        }

        button {
            padding: 6px 12px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background-color: #218838;
        }

        /* 비밀번호 재설정 모달 */
        #resetModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            width: 300px;
        }

        #resetModal h3 {
            margin-top: 0;
            font-size: 20px;
            color: #333;
        }

        #resetModal input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        #resetModal button {
            width: 48%;
            margin: 5px;
            padding: 8px;
            font-size: 14px;
        }



        /* 반응형 테이블 디자인 */
        @media (max-width: 768px) {
            table {
                font-size: 14px;
            }

            th, td {
                padding: 8px;
            }
        }

        @media (max-width: 480px) {
            table {
                font-size: 12px;
            }

            th, td {
                padding: 6px;
            }

            button {
                font-size: 12px;
                padding: 4px 8px;
            }
        }
    </style>
</head>
<body>
<a href="/adminPage" class="home-button">홈으로</a>
<h2>홈페이지 회원 목록</h2>
<table>
    <tr>
        <th>번호</th>
        <th>이름</th>
        <th>ID</th>
        <th>비밀번호</th>
        <th>성별</th>
        <th>전화번호</th>
        <th>주소</th>
        <th>이메일</th>
        <th>비밀번호 재설정</th>
    </tr>
    <tr th:each="member: ${memberList}">
        <td th:text="${member.id}"></td>
        <td th:text="${member.username}"></td>
        <td th:text="${member.useryd}"></td>
        <td th:text="${member.password}"></td>
        <td th:text="${member.sex}"></td>
        <td th:text="${member.phnum}"></td>
        <td th:text="${member.address}"></td>
        <td th:text="${member.email}"></td>
        <!-- 비밀번호 재설정 버튼 추가 -->
        <td>
            <button th:onclick="|resetPassword('${member.id}')|" type="button">비밀번호 재설정</button>
        </td>

    </tr>
</table>



<div id="resetModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background-color:#fff; padding:20px; box-shadow:0 0 10px rgba(0,0,0,0.5);">
    <h3>비밀번호 재설정</h3>
    <input type="password" id="newPassword" placeholder="새 비밀번호 입력">
    <button onclick="submitNewPassword()">변경</button>
    <button onclick="closeModal()">취소</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const jwtToken = localStorage.getItem('jwtToken');
        if (!jwtToken) {
            window.location.href = '/login'; // 토큰이 없는 경우 로그인 페이지로 이동
        } else {
            fetch('/list', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + jwtToken
                }
            }).then(response => {
                if (!response.ok) {
                    throw new Error('인증 실패');
                } } else {
                    response.text().then(html => {
                        document.open();
                        document.write(html);
                        document.close();
                    });
                }
            }).catch(error => {
                console.error('에러:', error);
                window.location.href = '/login'; // 인증 실패 시 로그인 페이지로 이동
            });
        }
    });
</script>
<script>
    let selectedMemberId = null;

    function resetPassword(memberId) {
        selectedMemberId = memberId;
        document.getElementById("resetModal").style.display = "block";
        document.getElementById("modalOverlay").style.display = "block";
    }

    function closeModal() {
        document.getElementById("resetModal").style.display = "none";
        document.getElementById("modalOverlay").style.display = "none";
    }

   function submitNewPassword() {
    const newPassword = document.getElementById("newPassword").value;
    if (!newPassword) {
        alert("새 비밀번호를 입력해주세요.");
        return;
    }

              // 비밀번호 변경 요청
    fetch(`/member/resetPassword`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            id: selectedMemberId,
            password: newPassword
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error("서버 응답 오류");
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            alert("비밀번호가 성공적으로 변경되었습니다.");
        } else {
            // 서버에서 반환한 메시지 출력
            alert(data.message || "비밀번호 변경에 실패했습니다.");
        }
        closeModal();
    })

}


</script>
</body>
</html>